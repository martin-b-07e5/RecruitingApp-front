server {
    listen 80;
    server_name hackaton202508.duckdns.org; # Keep domain for the certificate
    return 301 https://$host:3003$request_uri; # Redirect to port 3003
}

server {
     listen 443 ssl;
     server_name hackaton202508.duckdns.org; # Keep domain for the certificate

     ssl_certificate /etc/letsencrypt/live/hackaton202508.duckdns.org/fullchain.pem;
     ssl_certificate_key /etc/letsencrypt/live/hackaton202508.duckdns.org/privkey.pem;

     root /usr/share/nginx/html; # Serve static files from here
     index index.html index.htm;
     # Handle all routes by serving index.html for SPA (client-side routing)
     location / {
         try_files $uri $uri/ /index.html; # Support for SPA (handles F5)
         add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https:; connect-src 'self' https://www.googletagmanager.com https://www.google-analytics.com;";
     }

     # Serve static assets with caching
     location ~* \.(?:ico|css|js|gif|jpe?g|png|woff2?|eot|ttf|svg)$ {
         expires 1y;
         access_log off;
         add_header Cache-Control "public";
     }

     # Handle 404 by serving index.html for SPA
     error_page 404 /index.html;

     # Enable gzip compression
     gzip on;
     gzip_vary on;
     gzip_min_length 1024;
     gzip_types
         text/plain
         text/css
         text/xml
         text/javascript
         application/javascript
         application/xml+rss
         application/json;
}
